## 1. 多线程下载 100W 资源

用 Java 写一个程序实现爬虫爬 100W篇论文，把论文标题，作者，期刊，日期等存储到数据库中。

有哪些技术手段可以让程序运行尽量更快？

**业务代码层面**

**1️⃣** 多线程并发处理

1. 创建一个线程池，同时运行多个线程来并行处理论文页面的爬取和解析。
2. **合理设置线程数量**，避免过多线程导致系统资源竞争和性能下降。

2️⃣ 数据批量处理：不是每获取一篇论文的信息就立即存储到数据库，而是先在内存中积累一定数量的论文数据，例如 100 或 1000 条。**使用批量插入语句一次性将这些数据写入数据库**，减少与数据库的交互次数。

**数据存储层面**

**1️⃣** 优化数据库操作：

1. 为存储论文信息的表建立合适的索引，加快数据的查询和插入速度。
2. 合理设置数据库连接池，避免频繁创建和关闭数据库连接。

2️⃣ 缓存机制：对于已经爬取过的页面或已经获取过的重复信息，可以使用缓存来避免重复处理。

**工具框架层面**

高性能解析库：选择性能较好的 HTML 解析库，如 Jsoup，以快速准确地提取论文的标题、作者、期刊和日期等信息。

**网络连接与传输**

**1️⃣** 优化网络请求：

1. 设置合理的请求头，模拟正常的浏览器行为，避免被网站封禁。
2. 控制请求频率，避免对目标网站造成过大的压力。

2️⃣ 错误处理和重试机制：

1. 处理爬取过程中的网络错误、页面解析错误等异常情况。
2. 对于暂时的错误，设置合理的重试次数和间隔，以提高数据获取的成功率。

3️⃣ 数据压缩和传输：在数据传输过程中，对要存储的数据进行压缩，减少网络传输的时间和带宽消耗。

**系统架构设计**

分布式爬虫：如果单台机器的性能无法满足需求，可以考虑使用分布式爬虫架构，将任务分配到多台机器上同时进行。

**监控和调优层面**

在程序运行过程中，实时监控关键指标，如线程执行情况、内存使用、数据库操作耗时等，根据监控数据进行针对性的调优和优化策略的调整。

分析代码执行阶段线程状态转换？

在程序运行时，执行不同功能时线程的状态可能会有所不同，具体如下：

1. **发送请求**：当爬虫程序发送请求时，线程处于运行状态。
2. **获取响应**：在获取响应时，线程可能会进入阻塞状态，等待服务器返回数据。
3. **解析响应**：解析响应时，线程通常也处于运行状态。
4. **存储数据**：存储数据时，线程的状态取决于存储方式和数据量的大小。如果存储操作比较耗时，线程可能会进入阻塞状态；如果存储操作比较快，线程可能会很快完成并继续执行其他任务。
5. **处理 URL 路径**：在处理 URL 路径时，线程的状态也可能会有所不同。如果需要进行复杂的路径处理或涉及到文件操作，线程可能会进入阻塞状态；如果路径处理比较简单，线程可能会很快完成并继续执行其他任务。

加速数据库数据插入可以考虑的技术手段？

1. **使用批量插入**：传统的逐条插入数据方式效率较低，而批量插入可以减少与数据库的交互次数，从而提高插入效率。例如在 Java 中，可使用 JDBC 的addBatch和executeBatch方法实现批量插入；
2. **使用事务**：事务将一系列操作作为一个整体进行提交或回滚。在数据存储过程中使用事务，能减少与数据库的交互次数，进而提高存储效率；
3. **优化索引**：选择合适的索引类型，如 B-tree、Hash、Full-text 等，并在适当的列（通常是具有大量唯一值的高选择性列）上创建索引。同时需避免过多索引，因为这会增加写操作的负担。也可使用复合索引，当查询条件包含多个列时能提高查询效率。并且要定期审查和维护索引，以确保其有效性；
4. **选择合适的存储引擎**：不同的存储引擎有不同的特点。例如，InnoDB 支持事务处理、行级锁定和外键，适用于需要高并发和事务支持的应用；而 MyISAM 以高速读取性能著称，适用于读取密集型的应用。需根据应用的读写比例、事务需求等特点来选择合适的存储引擎，并根据所选存储引擎调整相关配置；
5. **调整数据库配置**：例如适当增加缓冲池大小，可减少磁盘 I/O 操作；合理配置线程池提高并发处理能力等；
6. **利用缓存**：将经常访问的数据存储在缓存中，以减少对数据库的直接访问。缓存适合读多写少且数据有一定热点属性的场景；
7. **数据分区**：根据特定的规则将数据分散到不同的分区或表中，可并行处理数据插入操作，提高整体性能；
8. **优化查询语句**：简化和重构查询语句，避免使用复杂的子查询，尽量使用JOIN语句，同时要确保查询能够有效利用索引，避免全表扫描；
9. **使用线程池**：通过线程池将数据存储任务分配给多个线程并行处理，从而加快存储速度；
10. **硬件优化**：采用高性能的硬件，如使用 SSD 固态硬盘来替代传统硬盘，可以显著提高数据的读写速度；
11. **监控和评估性能指标**：使用相关工具实时监控数据库的状态，分析查询响应时间、吞吐量、CPU 和内存使用率、I/O 等待时间等性能指标，以便发现潜在的瓶颈并进行针对性优化。

## 2. 100G 整数排序

100个G的整数，如何在4G内存进行排序

## 3. Top k 问题

10亿个数据中找出最大的10000个？

方案1：小顶堆

1. 维护一个大小为10000的小顶堆
2. 遍历10亿个数据，将将数据逐个插入堆中。

1. 如果堆的大小小于10000：直接插入。
2. 如果堆的大小等于10000且当前数据大于堆顶元素：则将堆顶元素删除，并插入当前数据，调整堆结构使其仍然是小顶堆

1. 遍历结束后，堆中存储的即是最大的10000个数据。

遍历所有数据的时间复杂度为O(N)，每次插入或删除操作的时间复杂度为 O(log K)，因此总时间复杂度 O(NlogK)

**如果内存不足？**

方式2：分治法

如果内存不足，将大数据划分成多个较小的数据子集（比如每个子集1000000数据量），每个子集找出前10000个元素再将结果合并。如果内存不够用可以将部分数据和中间结果暂存到磁盘上，每次从磁盘读取一部分数据到内存处理，然后将结果再次写入磁盘。

时间复杂度分析：

1. 将 10 亿个数据分块，N 个数据分成 N/M 块，每个块有 M 个数据
2. 然后每个块按逆序排序，时间复杂度为 Mlog(M)，总时间复杂度就是 Nlog(M)
3. 再进行归并排序，取前 10000 个数据，时间复杂度为 Nlog(N/M)

## 4. 设计一个抽奖系统

## 5. 设计用户登陆策略

## 6. 设计一个高并发的计数器

保证数据一致性和性能优化

## 7. 图片存储系统

10 亿数据量的图片存储服务，如果想快速拿取无人机相关的图片该怎么设计这个服务及其索引，索引怎么拿，可能会有的性能瓶颈是什么，怎么提升性能？



怎么在一个巨大的文件中找出出现次数最多的IP地址？
LFU算法